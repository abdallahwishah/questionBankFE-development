<div [@routerTransition] class="card p-3 h-100">
    <div class="container-fluid px-5 mt-5" style="height: 90%">
        <div class="d-flex justify-content-between">
            <h2
                class="fs-3 fw-medium justify-content-center mb-4 page-heading text-dark"
                style="align-content: flex-end"
            >
                {{ l('SessionsScreen') }}
            </h2>

            <div class="col-md-3 d-grid justify-content-end gap-5" style="grid-template-columns: 1fr auto">
                <app-dropdown-field
                    [placeholder]="'Status'"
                    optionLabel="name"
                    optionValue="id"
                    [options]="sessionStatus"
                    [(ngModel)]="isStatusFilter"
                    (ngModelChange)="getList()"
                ></app-dropdown-field>
            </div>
        </div>
        <div class="row" style="height: 100%">
            <!-- Start Tabel -->
            <div class="primeng-datatable-container p-0 mb-9 col-12 mt-6" style="height: 85%">
                <p-table
                    #dataTable
                    [value]="primengTableHelper.records"
                    (onLazyLoad)="getList($event)"
                    rows="{{ primengTableHelper.defaultRecordsCountPerPage }}"
                    [paginator]="false"
                    [loading]="primengTableHelper.isLoading"
                    [lazy]="true"
                    [scrollable]="true"
                    ScrollWidth="100%"
                    ScrollHeight="100%"
                    [resizableColumns]="primengTableHelper.resizableColumns"
                >
                    <ng-template pTemplate="header">
                        <tr>
                            <th pSortableColumn="caseCode">
                                {{ '#' }}
                            </th>
                            <th pSortableColumn="SessionName">
                                {{ l('SessionName') }}
                                <p-sortIcon field="SessionName"></p-sortIcon>
                            </th>
                            <th pSortableColumn="studyLevel">
                                {{ l('StudyLevel') }}
                                <p-sortIcon field="studyLevel"></p-sortIcon>
                            </th>
                            <th pSortableColumn="studySubject">
                                {{ l('StudySubject') }}
                                <p-sortIcon field="studySubject"></p-sortIcon>
                            </th>

                            <th pSortableColumn="">
                                {{ l('NumberOfSchools') }}
                                <p-sortIcon field=""></p-sortIcon>
                            </th>
                            <th pSortableColumn="StartDate">
                                {{ l('StartDate') }}
                                <p-sortIcon field="StartDate"></p-sortIcon>
                            </th>
                            <th pSortableColumn="EndDate">
                                {{ l('EndDate') }}
                                <p-sortIcon field="EndDate"></p-sortIcon>
                            </th>
                            <th pSortableColumn="Status">
                                {{ l('Status') }}
                                <p-sortIcon field="Status"></p-sortIcon>
                            </th>
                            <th>
                                {{ l('Actions') }}
                            </th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-record="$implicit" let-i="rowIndex">
                        <tr>
                            <td>
                                {{ i + paginator.getPage() * primengTableHelper.defaultRecordsCountPerPage + 1 }}
                            </td>
                            <td>
                                <span class="p-column-title">{{ l('name') }}</span>
                                {{ record.session.name || '-' }}
                            </td>
                            <td>
                                {{ record.studyLevel || '-' }}
                            </td>
                            <td>
                                {{ record.studySubject || '-' }}
                            </td>
                            <td>
                                <span class="p-column-title">{{ l('NumberOfSchools') }}</span>
                                {{ record.numberOfSchools }}
                            </td>

                            <td>
                                <span class="p-column-title">{{ l('startDate') }}</span>
                                {{ (record.session.startDate | luxonFormat: 'dd/MM/yyyy hh:mm a') || '-' }}
                            </td>
                            <td>
                                <span class="p-column-title">{{ l('endDate') }}</span>
                                {{ (record.session.endDate | luxonFormat: 'dd/MM/yyyy hh:mm a') || '-' }}
                            </td>
                            <td>
                                <span class="p-column-title">{{ l('StudyLevel') }}</span>
                                @if (record?.session?.status === sessionStatusEnum.Active) {
                                    <div class="status-grean w-auto">
                                        {{ l('Active') }}
                                    </div>
                                } @else if (record?.session?.status === sessionStatusEnum.Finished) {
                                    <div class="status-grean w-auto">{{ l('Finished') }}</div>
                                } @else if (record?.session?.status === sessionStatusEnum.InCreation) {
                                    <div class="status-info w-auto">{{ l('InCreation') }}</div>
                                } @else if (record?.session?.status === sessionStatusEnum.Invalid) {
                                    <div class="status-read w-auto">{{ l('Invalid') }}</div>
                                } @else if (record?.session?.status === sessionStatusEnum.NotStarted) {
                                    <div class="status-notStarted w-auto">{{ l('NotStarted') }}</div>
                                } @else if (record?.session?.status === sessionStatusEnum.Suspended) {
                                    <div class="status-suspended w-auto">{{ l('Suspended') }}</div>
                                }
                            </td>
                            <td>
                                <app-action-button
                                    *ngIf="record?.session?.status != sessionStatusEnum.InCreation"
                                    [ActionsInfo]="[
                                        {
                                            label: 'ViewSchools',
                                            hasCondition: record?.session?.status != sessionStatusEnum.InCreation
                                        }
                                    ]"
                                    (action)="doActions($event, record)"
                                ></app-action-button>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="9" class="primeng-no-data">{{ l('NoData') }}</td>
                        </tr>
                    </ng-template>
                </p-table>

                <p-paginator
                    #paginator
                    [rows]="primengTableHelper.defaultRecordsCountPerPage"
                    (onPageChange)="getList($event)"
                    [totalRecords]="primengTableHelper.totalRecordsCount"
                    [rows]="primengTableHelper.defaultRecordsCountPerPage"
                    [rowsPerPageOptions]="primengTableHelper.predefinedRecordsCountPerPage"
                ></p-paginator>
            </div>
            <!-- End Tabel -->
        </div>
    </div>
</div>
